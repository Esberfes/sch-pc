<?xml version='1.0' encoding='UTF-8'?>           
<template role="historical" version="1.0" type="role">

    <parameters>
         <parameter id="par_historical_diagnosis_table" type="table" techview="ifused">
            <contents>
                <value type="infosource_table" infosource="historicalms" endpointid="getdiagnosisexecution">data.</value>
            </contents>
           <sequence>
                <operation type="header_selector">
                    <args><arg><value type="value">activityId;sessionId;source;sourceDetail;contents.diagnosisId;contents.resolutionId;ttCreated</value></arg></args>
                </operation>
                <operation type="first_row">
                    <args><arg><value type="value">2</value></arg></args>
                </operation>
                <operation type="add_header">
					<args><arg><value type="value">ID Actividad;ID Sesión;Canal;Sub-Canal;Diagnóstico;Resolución;TT</value></arg></args>
                </operation>
                <operation type="column_index">
                  <args><arg><value type="value">1</value></arg></args>
                </operation>
                <operation type="column_not_equal">
                    <args><arg><value type="value">unknown</value></arg></args>
                </operation>
            </sequence>
        </parameter> 
		<parameter id="par_historical_diagnosis_errorcodeendpoint" type="value">
			<contents>
				<value type="infosource_value" infosource="historicalms" endpointid="getdiagnosisexecution">_errCode</value>
			</contents>
		</parameter>
		<parameter id="par_historical_diagnosis_errordescriptionendpoint" type="value">
			<contents>
				<value type="infosource_value" infosource="historicalms" endpointid="getdiagnosisexecution">_errDesc</value>
			</contents>
		</parameter>
        <parameter id="par_historical_session_table" type="table" techview="never">
            <contents>
                <value type="infosource_table" infosource="historicalms" endpointid="getsessions">data.</value>
            </contents>
            <sequence>
                <operation type="header_selector">
                    <args><arg><value type="value">id;ttCreated;state</value></arg></args>
                </operation>
            </sequence>
        </parameter>
            <parameter id="par_historical_sessions_errorcodeendpoint" type="value">
                <contents>
                    <value type="infosource_value" infosource="historicalms" endpointid="getsessions">_errCode</value>
                </contents>
            </parameter>

			<parameter id="par_historical_any_diag_autoreboot_lastXh_count" type="value">
				<contents>
					<value type="parameter">par_historical_diagnosis_table</value>
				</contents>
				<sequence>
					<operation type="ignore_header">
					  <args><arg><value type="value">true</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">3</value></arg></args>
					</operation>
					<operation type="replace_pattern">
						<args><arg><value type="value">ivr|flow@to@any</value></arg></args>
					</operation>
					<operation type="column_equal">
						<args><arg><value type="value">any</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">6</value></arg></args>
					</operation>
					<operation type="column_contain">
						<args><arg><value type="value">autoreboot</value></arg></args>
					</operation>
					<operation type="number_of_rows"/>
				</sequence>
			</parameter>
			<!--CCA20230620 - SP2701 - inicio-->
			<parameter id="par_historical_any_diag_manualreboot_lastXh_count" type="value">
				<contents>
					<value type="parameter">par_historical_diagnosis_table</value>
				</contents>
				<sequence>
					<operation type="ignore_header">
					  <args><arg><value type="value">true</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">3</value></arg></args>
					</operation>
					<operation type="replace_pattern">
						<args><arg><value type="value">ivr|flow@to@any</value></arg></args>
					</operation>
					<operation type="column_equal">
						<args><arg><value type="value">any</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">6</value></arg></args>
					</operation>
					<operation type="column_contain">
						<args><arg><value type="value">reboot</value></arg></args>
					</operation>
					<operation type="number_of_rows"/>
				</sequence>
			</parameter>
			<!--CCA20230620 - SP2701 - fin-->
			<!-- JJSM 20231003 - SP3105 - INICIO -->
			<parameter id="par_tabla_historico_vt" type="table">
				<contents>
					<value type="parameter">par_historical_diagnosis_table</value>
				</contents>
				<sequence>
					<operation type="column_left">
						<args><arg><value type="value">ID Sesión</value></arg></args>
					</operation>
					<operation type="column_right">
						<args><arg><value type="value">id</value></arg></args>
					</operation>
					<operation type="join">
						<args><arg><value type="parameter">par_historical_session_table</value></arg></args>
					</operation>
					<operation type="first_row">
					  <args><arg><value type="value">2</value></arg></args>
					</operation>
					<operation type="add_header">
						<args><arg><value type="value">ID Actividad;ID Sesión;Source;Sourcedetail;Diagnóstico;Resolución;Fecha;ttCreated;Salida</value></arg></args>
					</operation>
					<operation type="header_selector">
						<args><arg><value type="value">Fecha;Diagnóstico;Resolución;Source;Sourcedetail;Salida</value></arg></args>
					</operation>
					<operation type="ignore_header">
					  <args><arg><value type="value">true</value></arg></args>
					</operation>
					<operation type="column_index">
						<args><arg><value type="value">1</value></arg></args>
					</operation>
					<operation type="parse_date">
						<args><arg><value type="value">yyyy-MM-dd'T'HH:mm:ss</value></arg></args>
					</operation>
				   <operation type="order_num">
					 <args><arg><value type="value">desc</value></arg></args>
				   </operation>
					<operation type="parse_timestamp">
						<args><arg><value type="value">yyyy-MM-dd HH:mm:ss</value></arg></args>
					</operation>
				</sequence>
			</parameter>
			<!-- JJSM 20231003 - SP3105 - FIN -->
			<parameter id="par_historical_any_diag_autoreboot_lastXh_issolved_count" type="value">
				<contents>
					<value type="parameter">par_historical_diagnosis_table</value>
				</contents>
				<sequence>
					<operation type="ignore_header">
					  <args><arg><value type="value">true</value></arg></args>
					</operation>
					 <operation type="column_index">
					  <args><arg><value type="value">3</value></arg></args>
					</operation>
					<operation type="replace_pattern">
						<args><arg><value type="value">ivr|flow@to@any</value></arg></args>
					</operation>
					<operation type="column_equal">
						<args><arg><value type="value">any</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">6</value></arg></args>
					</operation>
					<operation type="column_contain">
						<args><arg><value type="value">autoreboot</value></arg></args>
					</operation> 
					<operation type="column_left">
						<args><arg><value type="value">ID Sesión</value></arg></args>
					</operation>
					<operation type="column_right">
						<args><arg><value type="value">id</value></arg></args>
					</operation>
					<operation type="join">
						<args><arg><value type="parameter">par_historical_session_table</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">9</value></arg></args>
					</operation>
					<operation type="column_equal">
						<args><arg><value type="value">solved</value></arg></args>
					</operation>
					 <operation type="number_of_rows"/> 
				</sequence>
			</parameter>
			<!--CCA20230620 - SP2701 - inicio-->
			<parameter id="par_historical_any_diag_manualreboot_lastXh_issolved_reboot_msisdn_count" type="value">
				<contents>
					<value type="parameter">par_historical_diagnosis_table</value>
				</contents>
				<sequence>
					<operation type="ignore_header">
					  <args><arg><value type="value">true</value></arg></args>
					</operation>
					 <operation type="column_index">
					  <args><arg><value type="value">3</value></arg></args>
					</operation>
					<operation type="replace_pattern">
						<args><arg><value type="value">ivr|flow@to@any</value></arg></args>
					</operation>
					<operation type="column_equal">
						<args><arg><value type="value">any</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">6</value></arg></args>
					</operation>
					<operation type="column_contain">
						<args><arg><value type="value">reboot</value></arg></args>
					</operation> 
					<operation type="column_not_contain">
						<args><arg><value type="value">noreboot</value></arg></args>
					</operation> 
					<operation type="column_left">
						<args><arg><value type="value">ID Sesión</value></arg></args>
					</operation>
					<operation type="column_right">
						<args><arg><value type="value">id</value></arg></args>
					</operation>
					<operation type="join">
						<args><arg><value type="parameter">par_historical_session_table</value></arg></args>
					</operation>
					<operation type="column_index">
					  <args><arg><value type="value">9</value></arg></args>
					</operation>
					<operation type="column_contain">
						<args><arg><value type="value">solved</value></arg></args>
					</operation>
					 <operation type="number_of_rows"/> 
				</sequence>
			</parameter>
			<!--CCA20230620 - SP2701 - fin-->
    </parameters>
    <tests>
        <test id="tst_template">
            <expr type="and" result="true"/>
        </test>
		<test id="tst_any_diag_autoreboot_lastXh_issolved">
			<expr type="and">
				<reference type="check" id="chk_historical_diagnosis_errorcodeendopoint_eq0"/>
				<reference type="check" id="chk_historical_any_diag_autoreboot_lastXh_count_gt0"/>
				<reference type="check" id="chk_historical_sessions_errorcodeendpoint_eq0"/>
				<reference type="check" id="chk_historical_any_diag_autoreboot_lastXh_issolved_count_gt0"/>
			</expr>
		</test>
		<!--CCA20230620 - SP2701 - inicio-->
		<test id="tst_any_diag_autoreboot_lastXh_issolved_reboot_msisdn">
			<expr type="and">
				<reference type="check" id="chk_historical_diagnosis_errorcodeendopoint_eq0"/>
				<reference type="check" id="chk_historical_any_diag_manualreboot_lastXh_count_gt0"/>
				<reference type="check" id="chk_historical_sessions_errorcodeendpoint_eq0"/>
				<reference type="check" id="chk_historical_any_diag_manualreboot_lastXh_issolved_reboot_msisdn_count_gt0"/>
			</expr>
		</test>
		<!--CCA20230620 - SP2701 - fin-->
    </tests>
    <checks>
		<check id="chk_historical_diagnosis_errorcodeendopoint_eq0">
			<parameter>par_historical_diagnosis_errorcodeendpoint</parameter>
			<result>
				<expr type="and">
					<operation type="equal">
						<args><arg><value type="value">0</value></arg></args>
					</operation>
				</expr>
			</result>
		</check>
		<check id="chk_historical_sessions_errorcodeendpoint_eq0">
			<parameter>par_historical_sessions_errorcodeendpoint</parameter>
			<result>
				<expr type="and">
					<operation type="equal">
						<args><arg><value type="value">0</value></arg></args>
					</operation>
				</expr>
			</result>
		</check>
			
		<check id="chk_historical_any_diag_autoreboot_lastXh_count_gt0">
			<parameter>par_historical_any_diag_autoreboot_lastXh_count</parameter>
			<result>
				<expr type="and">
					<operation type="greater">
						<args><arg><value type="value">0</value></arg></args>
					</operation>
				</expr>
			</result>
		</check>
		<check id="chk_historical_any_diag_autoreboot_lastXh_issolved_count_gt0">
			<parameter>par_historical_any_diag_autoreboot_lastXh_issolved_count</parameter>
			<result>
				<expr type="and">
					<operation type="greater">
						<args><arg><value type="value">0</value></arg></args>
					</operation>
				</expr>
			</result>
		</check>
		<!--CCA20230620 - SP2701 - inicio-->
		<check id="chk_historical_any_diag_manualreboot_lastXh_count_gt0">
			<parameter>par_historical_any_diag_manualreboot_lastXh_count</parameter>
			<result>
				<expr type="and">
					<operation type="greater">
						<args><arg><value type="value">0</value></arg></args>
					</operation>
				</expr>
			</result>
		</check>
		<check id="chk_historical_any_diag_manualreboot_lastXh_issolved_reboot_msisdn_count_gt0">
			<parameter>par_historical_any_diag_manualreboot_lastXh_issolved_reboot_msisdn_count</parameter>
			<result>
				<expr type="and">
					<operation type="greater">
						<args><arg><value type="value">0</value></arg></args>
					</operation>
				</expr>
			</result>
		</check>
		<!--CCA20230620 - SP2701 - fin-->
    </checks>
    <actions/>

</template>
