<?xml version='1.0' encoding='UTF-8'?>
<template infosource="ext1" version="1.0" type="infosource">
   	<!-- ############################################################################################## --> 
    <!-- Version 1.0                                                                					-->
    <!--  - Version de partida                                                                          -->
    <!-- ############################################################################################## -->
    <connectivity>
        <troubleshoot>
            <endpoints>
                <endpoint type="ws" id="Checkonline_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="19000"><!--CCA20220531 - Cambia el valor de requesttimeout-->
	                <method>GET</method>
	                <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/{serviceid}</url>
	                <args>
	                	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
	                	<arg type="path" id="serviceid">
							<value type="parameter" parameterid="par_cpe_serviceid_serialnnumber_exten1"/>
						</arg>
						<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Checkonline</content></value>
						</arg>
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
                  		</arg>
              		</args>
              		<response type="json"/>
	            </endpoint>

                <endpoint type="ws" id="Obtener_Dispositivos_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="1000"><!--CCA20220531 - Cambia el valor de requesttimeout-->
	                <method>GET</method>
	                <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/{serviceid}</url>
	                <args>
	                	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
	                	<arg type="path" id="serviceid">
							<value type="parameter" parameterid="par_cpe_serviceid_serialnnumber_exten1"/>
						</arg>
						<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Obtener_Dispositivos</content></value>
						</arg>
						<!--<arg type="header" id="X-VF-API-Mock">
							<value type="value"><content>001</content></value>
						</arg>-->
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
                  		</arg>
              		</args>
              		<response type="json"/>
	            </endpoint>

                <endpoint type="ws" id="Obtener_Firmware_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="2000"><!--CCA20220531 - Cambia el valor de requesttimeout-->
	                <method>GET</method>
	                <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/search</url>
	                <args>
	                	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
						<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Obtener_Firmware</content></value>
						</arg>
						<!--<arg type="header" id="X-VF-API-Mock">
							<value type="value"><content>001</content></value>
						</arg>-->
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
                  		</arg>
                  		<!--<arg type="query" id="Data_login">
                  			<value type="parameter" parameterid="par_inet_data_login"/>
                  		</arg>
                  		<arg type="query" id="IP_BRAS">
                  			<value type="parameter" parameterid="par_ip_bras"/>
                  		</arg>-->
              		</args>
              		<body contenttype="text">
              			<text>
              				<value type="value"><content><![CDATA[{"queries":[{"query":"$.resource[*].id=]]></content></value>
              				<value type="parameter" parameterid="par_co_ext1_resource_id" role="ext1"/>
              				<value type="value"><content><![CDATA["},{"query":"$.resource[*].extraId[schemeName='productClass'].value=]]></content></value>
              				<value type="parameter" parameterid="par_od_ext1_resource_productclass" role="ext1"/>
              				<value type="value"><content><![CDATA["},{"query":"$.relatedResourceConfiguration[*].extraId[schemeName='protocol'].value=]]></content></value>
              				<value type="parameter" parameterid="par_co_ext1_rrc_protocol" role="ext1"/>
              				<value type="value"><content><![CDATA["},{"query":"$.resource[*].extraId[schemeName='serialNumber'].value=]]></content></value>
              				<value type="parameter" parameterid="par_od_ext1_resource_serialnumber" role="ext1"/>
              				<value type="value"><content><![CDATA["}]}]]></content></value>
						</text>
					</body>
              		<response type="json"/>
	            </endpoint>
            </endpoints>
        </troubleshoot>
        <action>
            <endpoints connecttimeout="300000" requesttimeout="20000">

                <endpoint type="ws" id="reboot_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="15000">
				    <method>PATCH</method>
				    <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/{serviceid}</url>
				    <args>
				    	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
						<arg type="path" id="serviceid">
							<value type="parameter" parameterid="par_cpe_serviceid_serialnnumber_exten1"/>
						</arg>
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
				  		</arg>
				  		<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Reboot</content></value>
						</arg>
					</args>
					<response type="json"/>
				</endpoint>

                <endpoint type="ws" id="Reconfigurar_CPE_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="20000">
				    <method>PATCH</method>
				    <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/{serviceid}</url>
				    <args>
				    	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
						<arg type="path" id="serviceid">
							<value type="parameter" parameterid="par_cpe_serviceid_serialnnumber_exten1"/>
						</arg>
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
				  		</arg>
				  		<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Reconfigurar_CPE</content></value>
						</arg>
					</args>
					<response type="json"/>
				</endpoint>

                <endpoint type="ws" id="firmware_update_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="20000">
				    <method>PATCH</method>
				    <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/{oui}</url>
				    <args>
				    	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
						<arg type="path" id="oui">
							<value type="parameter" parameterid="par_co_ext1_resource_id" role="ext1"/>
						</arg>
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
				  		</arg>
				  		<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Firmware_update</content></value>
						</arg>
					</args>
					<body contenttype="text">
						<text>
							<value type="value"><content><![CDATA[[{
										  "op": "replace",
										  "path": "$.resource[*].extraId[schemeName='productClass']",
										  "value": {
										      "value": "]]></content></value>
              				<value type="argument" argumentid="arg_productclass"/>
              				<value type="value"><content><![CDATA["
										           }
										 },
										 {
										  "op": "replace",
										  "path": "$.relatedResourceConfiguration[*].extraId[schemeName='protocol']",
										  "value": {
										      "value": "]]></content></value>
              				<value type="argument" argumentid="arg_protocol"/>
              				<value type="value"><content><![CDATA["
										           }
										 },
										 {
										  "op": "replace",
										  "path": "$.resource[*].extraId[schemeName='serialNumber']",
										  "value": {
										      "value": "]]></content></value>
              				<value type="argument" argumentid="arg_serialnumber"/>
              				<value type="value"><content><![CDATA["
										           }
										 },
										 {
										  "op": "replace",
										  "path": "$.resource[*].extraId[schemeName='firmwareImageName']",
										  "value": {
										       "value": "]]></content></value>
							<value type="argument" argumentid="arg_firmwareimagename"/>
              				<value type="value"><content><![CDATA["
										           }
										 }
										]]]></content></value>
						</text>
					</body>
					<response type="json"/>
				</endpoint>

                <endpoint type="ws" id="act_factory_reset_ext1" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="15000">
				    <method>PUT</method>
				    <url ignoreSSL="true">{url}/ResourceConfigurationREST/resourceConfiguration/{serviceid}</url>
				    <args>
				    	<arg type="path" id="url">
							<value type="parameter" parameterid="par_url_bus"/>
						</arg>
						<arg type="path" id="serviceid">
							<value type="parameter" parameterid="par_cpe_serviceid_serialnnumber_exten1"/>
						</arg>
						<arg type="header" id="Content-Type">
							<value type="value"><content>application/json</content></value>
				  		</arg>
				  		<arg type="header" id="Accept">
							<value type="value"><content>application/json</content></value>
						</arg>
						<arg type="header" id="X-IBM-Client-Id">
							<value type="parameter" parameterid="par_bus_clientid"/>
						</arg>
						<arg type="header" id="X-VF-API-Process">
							<value type="value"><content>Factory_Reset</content></value>
						</arg>
					</args>
					<response type="json"/>
				</endpoint>
            </endpoints>
        </action>
    </connectivity>
    <parameters>

        <parameter id="par_cpe_serviceid_serialnnumber_exten1" type="value" name="ID Servicio_serialnumber1">
            <contents>
                <value type="parameter" role="front">par_front_serviceid_serialnnumber_exten1</value>
            </contents>
			<sequence>
				<operation type="to_upper_case"/>
			</sequence>
        </parameter>

        <!-- ENDPOINT REQUEST PARAMS -->

        <parameter id="par_url_bus" techview="never">
            <contents>
                <value type="lookup">url_list</value>
            </contents>
            <sequence>
                <operation type="row_delimiter">
                <args><arg><value type="value">;</value></arg></args>
                </operation>
                <operation type="column_delimiter">
                <args><arg><value type="value">,</value></arg></args>
                </operation>
                <operation type="column_index">
                <args><arg><value type="value">1</value></arg></args>
                </operation>
                <operation type="column_equal">
                <args><arg><value type="value">url_bus</value></arg></args>
                </operation>
                <operation type="column_selector">
                <args><arg><value type="value">2</value></arg></args>
                </operation>
            </sequence>
        </parameter>

        <parameter id="par_bus_clientid" techview="never">
            <contents>
                <value type="lookup">url_list</value>
            </contents>
            <sequence>
                <operation type="row_delimiter">
                <args><arg><value type="value">;</value></arg></args>
                </operation>
                <operation type="column_delimiter">
                <args><arg><value type="value">,</value></arg></args>
                </operation>
                <operation type="column_index">
                <args><arg><value type="value">1</value></arg></args>
                </operation>
                <operation type="column_equal">
                <args><arg><value type="value">url_bus</value></arg></args>
                </operation>
                <operation type="column_selector">
                <args><arg><value type="value">3</value></arg></args>
                </operation>
            </sequence>
        </parameter>

    </parameters>
    <checks>
    </checks>
</template>