<?xml version='1.0' encoding='UTF-8'?>
<template infosource="ticketing" version="2.0" type="infosource">

    <!-- ############################################################################################## -->
    <!-- Version 1.3                                                                                    -->
    <!--  - Parámetros de GetRepeatedIncidents y OpenIncidents, checks y tests para comprobar si hay	-->
    <!--	incidencias reiteradas y abiertas.									    					-->
    <!-- Version 1.2                                                                                    -->
    <!--  - Configurado el endpoint 'OpenIncidents' para realizar la invocación usando el serviceID 	-->
    <!--	como entrada.	   																			-->
    <!-- Version 1.1                                                                                    -->
    <!--  - Configurado el endpoint 'GetRepeatedIncidents' para realizar la invocación usando el 		-->
    <!--	serviceID como entrada.	  																	-->
    <!-- Version 1.0                                                                                    -->
    <!--  - Version de partida                                                                          -->
    <!-- ############################################################################################## -->

    <connectivity>
	    <troubleshoot>

	        <endpoints>

            <!-- GetProblemsAffectedNetwork -->

	        	<!--<endpoint id="GPAN" verbose="true" lazy="true" type="ws" connecttimeout="20000" requesttimeout="20000">
	                <method>POST</method>
	                A la espera de una URL real, se usará un mock para avanzar con la extracción de parámetros.
	                <url ignoreSSL="true">http://www.mocky.io/v2/5d5d3b343300000d0057b853{url}/Consoles/CRMRemedyProblems.svc</url>
	                <args>
	                	<arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_biztalk"/>
                        </arg>
                        <arg type="header" id="Content-Type">
                            <value type="value"><content>application/soap+xml; charset=utf-8; action="GetProblemsAffectedNetwork"</content></value>
                        </arg>
                    </args>
                    <body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ns="http://ServicesPlatform/Consoles/1.0">
											   <soap:Header/>
											   <soap:Body>
											      <ns:GetProblemsAffectedNetwork>
											         <ns:Request>
											            <ns:ServiceID>]]></content></value>
                                        <value type="parameter" parameterid="par_front_service_id"/>
                                        <value type="value"><content><![CDATA[</ns:ServiceID>
											         </ns:Request>
											      </ns:GetProblemsAffectedNetwork>
											   </soap:Body>
											</soap:Envelope>]]></content></value>
                        </text>
                    </body>
	                <response type="xml2json1"/>
	            </endpoint>-->

                <!-- GetProblemsAffectedNetwork - new obtener problemas afectados -->
                <endpoint id="GPAN" verbose="true" lazy="false" type="ws" connecttimeout="20000" requesttimeout="1000"><!--CCA20220601 - Cambio en el valor de requesttimeout-->
                    <method>POST</method>
                    <url ignoreSSL="true">{url}TroubleTicketREST/troubleTicket/search</url>
                    <args>
                        <arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_bizbus"/>
                        </arg>
                        <arg type="header" id="Accept">
                          <value type="value"><content>*/*</content></value>
                       </arg>
                       <arg type="header" id="X-IBM-Client-Id">
                          <value type="parameter" parameterid="par_bizbus_clientid"/>
                       </arg>
                       <arg type="header" id="X-VF-API-Process">
                          <value type="value"><content>ObtenerProblemasAfectados</content></value>
                       </arg>
                       <arg type="header" id="Content-Type">
                            <value type="value"><content>application/json</content></value>
                       </arg>
                    </args>
                    <body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[{"queries":[{"query": "$.id=]]></content></value>
                            <value type="parameter" parameterid="par_front_service_id"/>
                            <value type="value"><content><![CDATA["}]}]]></content></value>
                        </text>
                    </body>
                    <response type="json"/>
                </endpoint>

	            <!-- GetRepeatedIncidents
	            <endpoint id="GRI" verbose="true" lazy="true" type="ws" connecttimeout="20000" requesttimeout="20000">
	                <method>GET</method>
	                 A la espera de una URL real, se usará un mock para avanzar con la extracción de parámetros.
	                <url ignoreSSL="true">http://www.mocky.io/v2/5d6686de3300006600449d83--><!--http://www.mocky.io/v2/5d6539da3400004e00f446b7{url}/Consoles/CRMIncidents.svc</url>
	                <args>
	                	<arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_biztalk"/>
                        </arg>
                        <arg type="header" id="Content-Type">
                            <value type="value"><content>application/soap+xml; charset=utf-8; action="GetRepeatedIncidents"</content></value>
                        </arg>
                    </args>
                    <body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ns="http://ServicesPlatform/Consoles/1.0">
											   <soap:Header/>
											   <soap:Body>
											      <ns:GetRepeatedIncidents>
											         <ns:Request>
											            <ns:NIF>]]></content></value>
                                        <value type="parameter" parameterid="par_front_customer_cif"/>
                                        <value type="value"><content><![CDATA[</ns:NIF>
											            <ns:ServiceID>]]></content></value>
                                            <value type="parameter" parameterid="par_front_service_id"/>
                                            <value type="value"><content><![CDATA[</ns:ServiceID>
											         </ns:Request>
											      </ns:GetRepeatedIncidents>
											   </soap:Body>
											</soap:Envelope>]]></content></value>
                        </text>
                    </body>
	                <response type="xml2json1"/>
	            </endpoint>-->
	            
                <!-- GetRepeatedIncidents - new indidencias reiteradas -->

                <endpoint id="GRI" verbose="true" lazy="false" type="ws" connecttimeout="20000" requesttimeout="1000"><!--CCA20220601 - Cambio en el valor de requesttimeout-->
                    <method>POST</method>
                    <url ignoreSSL="true">{url}IncidentREST/incident/search</url>
                    <args>
                        <arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_bizbus"/>
                        </arg>
                        <arg type="header" id="Accept">
                          <value type="value"><content>*/*</content></value>
                       </arg>
                       <arg type="header" id="X-IBM-Client-Id">
                          <value type="parameter" parameterid="par_bizbus_clientid"/>
                       </arg>
                       <arg type="header" id="X-VF-API-Process">
                          <value type="value"><content>ConsultarIncidenciasReiteradas</content></value>
                       </arg>
                       <arg type="header" id="Content-Type">
                            <value type="value"><content>application/json</content></value>
                       </arg>
                    </args>
                    <body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[{"queries":[{"query": "$.id.[?(@schemeName=='ServiceId')].value=]]></content></value>
                            <value type="parameter" parameterid="par_front_service_id"/>
                            <value type="value"><content><![CDATA["},{"query": "$.id.[?(@schemeName=='NIF')].value=]]></content></value>
                            <value type="parameter" parameterid="par_front_customer_cif"/>
                            <value type="value"><content><![CDATA["}]}]]></content></value>
                        </text>
                    </body>
                    <response type="json"/>
                </endpoint>

	            <!-- OpenIncidents
	            <endpoint id="OI" verbose="true" lazy="true" type="ws" connecttimeout="20000" requesttimeout="20000">
	                <method>POST</method>
	                <url ignoreSSL="true">{url}/Consoles/CRMIncidents.svc</url>
	                <args>
	                	<arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_biztalk"/>
                        </arg>
                        <arg type="header" id="Content-Type">
                            <value type="value"><content>application/soap+xml; charset=utf-8; action="OpenIncidents"</content></value>
                        </arg>
                    </args>
                    <body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ns="http://ServicesPlatform/Consoles/1.0">
											   <soap:Header/>
											   <soap:Body>
											      <ns:OpenIncidents>
											         <ns:Request>
											            <ns:ServiceID>]]></content></value>
                                            <value type="parameter" parameterid="par_front_service_id"/>
                                            <value type="value"><content><![CDATA[</ns:ServiceID>
											         </ns:Request>
											      </ns:OpenIncidents>
											   </soap:Body>
											</soap:Envelope>]]></content></value>
                        </text>
                    </body>
	                <response type="xml2json1"/>
	            </endpoint>-->

                <!-- OpenIncidents - new indidencias abiertas -->
                <endpoint id="OI" verbose="true" lazy="false" type="ws" connecttimeout="2000" requesttimeout="2000"><!--CCA20220601 - Cambio en el valor de requesttimeout-->
                    <method>GET</method>
                    <url ignoreSSL="true">{url}IncidentREST/incident/{serviceid}</url>
                    <args>
                        <arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_bizbus"/>
                        </arg>
                        <arg type="path" id="serviceid">
                            <value type="parameter" parameterid="par_front_service_id"/>
                        </arg>
                        <arg type="header" id="Accept">
                          <value type="value"><content>*/*</content></value>
                       </arg>
                       <arg type="header" id="X-IBM-Client-Id">
                          <value type="parameter" parameterid="par_bizbus_clientid"/>
                       </arg>
                       <arg type="header" id="X-VF-API-Process">
                          <value type="value"><content>ConsultarIncidenciasAbiertas</content></value>
                       </arg>
                       <arg type="header" id="Content-Type">
                            <value type="value"><content>application/json</content></value>
                       </arg>
                    </args>
                    <!--<body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[{"queries":[{"query": "$.id.[?(@schemeName=='ServiceId')].value=]]></content></value>
                            <value type="parameter" parameterid="par_front_service_id"/>
                            <value type="value"><content><![CDATA["},{"query": "$.id.[?(@schemeName=='NIF')].value=]]></content></value>
                            <value type="parameter" parameterid="par_front_customer_cif"/>
                            <value type="value"><content><![CDATA["}]}]]></content></value>
                        </text>
                    </body>-->
                    <response type="json"/>
                </endpoint>
                <!-- SCB 20230321 - SP2603 - INICIO -->
                <!-- ObtenerInfoRGU - new web service para obtener masivas - MARZO 2023 -->
                <endpoint id="OIR" verbose="true" lazy="false" type="ws" connecttimeout="20000" requesttimeout="1000"><!--CCA20220601 - Cambio en el valor de requesttimeout-->
                    <method>POST</method>
                    <url ignoreSSL="true">{url}ServiceProblemSOAP11/GetServiceProblemList</url>
                    <args>
                        <arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_bizbus"/>
                        </arg>
                        <arg type="header" id="Accept">
                          <value type="value"><content>*/*</content></value>
                       </arg>
                       <arg type="header" id="X-IBM-Client-Id">
                          <value type="parameter" parameterid="par_bizbus_clientid"/>
                       </arg>
                       <arg type="header" id="X-VF-API-Process">
                          <value type="value"><content>ObtenerInfoRGU</content></value>
                       </arg>
                       <arg type="header" id="Content-Type">
                            <value type="value"><content>application/xml</content></value>
                       </arg>
                    </args>
                    <body contenttype="text">
                        <text>
                            <value type="value"><content><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:v1="http://group.vodafone.com/contract/vho/header/v1" xmlns:v11="http://group.vodafone.com/schema/common/v1" xmlns:urn="urn:un:unece:uncefact:documentation:standard:CoreComponentType:2" xmlns:v12="http://group.vodafone.com/schema/vbm/service/service-problem/v1">
                            <soap:Body>
                                <v12:GetServiceProblemListVBMRequest>
                                    <v11:Criteria>
                                    <v11:QueryExpression>
                                        <v11:QueryExpression>
                                            <v11:ValueExpression Path="/ServiceProblemVBO/Roles/Requestor/IDs/ID[@schemeName='ClientID']">
                                                <v11:Value>
                                            ]]></content></value>
                                            <value type="parameter" parameterid="par_front_client_id"/>
                                            <value type="value"><content><![CDATA[</v11:Value>
                                            </v11:ValueExpression>
                                            <v11:ValueExpression Path="/ServiceProblemVBO/Parts/Impacts/Impact/Categories/Category[@name='RGU']">
                                                <v11:Value>TODOS</v11:Value>
                                            </v11:ValueExpression>
                                        </v11:QueryExpression>
                                    </v11:QueryExpression>
                                    </v11:Criteria>
                                    <v11:Identification>
                                        <v11:Categories>
                                        <v11:Category name="Process">GetRGUInfo</v11:Category>
                                        </v11:Categories>
                                    </v11:Identification>
                                </v12:GetServiceProblemListVBMRequest>
                            </soap:Body>
                            </soap:Envelope>
                            ]]></content>
                        </value>
                        </text>
                    </body>
                    <response type="xml2json1"/>
                </endpoint>
                <!-- SCB 20230321 - SP2603 - FIN-->
	        </endpoints>
	    </troubleshoot>
	</connectivity>

    <parameters>

    	<!-- ENDPOINT REQUEST PARAMETERS -->
          <parameter id="par_url_biztalk" techview="never">
                <contents>
                	<value type="lookup">url_list</value>
                </contents>
                <sequence>
                  <operation type="row_delimiter">
                  	<args><arg><value type="value">;</value></arg></args>
                  </operation>
                  <operation type="column_delimiter">
                  	<args><arg><value type="value">,</value></arg></args>
                  </operation>
                  <operation type="column_index">
                  	<args><arg><value type="value">1</value></arg></args>
                  </operation>
                  <operation type="column_equal">
                  	<args><arg><value type="value">url_biztalk</value></arg></args>
                  </operation>
                  <operation type="column_selector">
                  	<args><arg><value type="value">2</value></arg></args>
                  </operation>
                </sequence>
            </parameter>

            <parameter id="par_url_bizbus">
                <contents>
                  <value type="lookup">url_list</value>
                </contents>
                <sequence>
                  <operation type="row_delimiter">
                    <args><arg><value type="value">;</value></arg></args>
                  </operation>
                  <operation type="column_delimiter">
                    <args><arg><value type="value">,</value></arg></args>
                  </operation>
                  <operation type="column_index">
                    <args><arg><value type="value">1</value></arg></args>
                  </operation>
                  <operation type="column_equal">
                    <args><arg><value type="value">url_bizbus</value></arg></args>
                  </operation>
                  <operation type="column_selector">
                    <args><arg><value type="value">2</value></arg></args>
                  </operation>
                </sequence>
            </parameter>

            <parameter id="par_bizbus_clientid">
                <contents>
                  <value type="lookup">url_list</value>
                </contents>
                <sequence>
                  <operation type="row_delimiter">
                    <args><arg><value type="value">;</value></arg></args>
                  </operation>
                  <operation type="column_delimiter">
                    <args><arg><value type="value">,</value></arg></args>
                  </operation>
                  <operation type="column_index">
                    <args><arg><value type="value">1</value></arg></args>
                  </operation>
                  <operation type="column_equal">
                    <args><arg><value type="value">url_bizbus</value></arg></args>
                  </operation>
                  <operation type="column_selector">
                    <args><arg><value type="value">3</value></arg></args>
                  </operation>
                </sequence>
            </parameter>

            <!-- Valor introducido para lanzar el trb -->
            <parameter id="par_front_service_id" type="value" name="ID Servicio">
                <contents>
                	<value type="parameter" role="front">par_grc_service_id</value>
                </contents>
            </parameter>
            <!-- SCB 20230321 - SP2603 - INICIO -->
            <parameter id="par_front_client_id" type="value" name="ID Cliente">
                <contents>
                	<value type="parameter" role="front">par_client_id</value>
                </contents>
            </parameter>
            <!-- SCB 20230321 - SP2603 - FIN -->

			<parameter id="par_front_customer_cif" type="value" name="NIF Cliente">
                <contents>
                	<value type="parameter" role="front">par_customer_cif</value>
                </contents>
            </parameter>            

    </parameters>
    <checks/>
</template>
