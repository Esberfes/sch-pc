<?xml version='1.0' encoding='UTF-8'?>
<template infosource="zhilabs" type="infosource" version="1.0">


<!-- ############################################################################################## --> 
<!-- Version 1.0                                                                					-->
<!--  - Version de partida                                                                          -->
<!-- ############################################################################################## -->

    <connectivity>
      <troubleshoot>
          <endpoints>

          <endpoint id="obtener_info_historica_serv" verbose="true" lazy="true" type="ws" connecttimeout="1000" requesttimeout="8000"><!--CCA20230621 - SP2711-->
            <method>POST</method>
             <url ignoreSSL="true">{url}/ResourceInventoryREST/resourceInventory/search</url> 
           <!-- <url ignoreSSL="true">https://run.mocky.io/v3/50552c75-b2fb-44f4-bedc-d1870ba84db9</url> -->
            <args>
                <arg type="path" id="url">
                    <value type="parameter" parameterid="par_url_bizbus"/>
                </arg>
                <arg type="header" id="Accept">
                  <value type="value"><content>application/json</content></value>
                </arg>
                <arg type="header" id="X-IBM-Client-Id">
                  <value type="parameter" parameterid="par_bizbus_clientid"/>
                </arg>
                <arg type="header" id="X-VF-API-Process">
                  <value type="value"><content>ObtenerHistoricoServicio</content></value>
                </arg>
                <arg type="header" id="Content-Type">
                    <value type="value"><content>application/json</content></value>
                </arg>
            </args>
            <body contenttype="text">
              <text>
                <value type="value"><content><![CDATA[
                {
                  "queries": [
                   {
                    "query": "$.id[?(@.schemeName='ServiceID')].value=]]></content></value><value type="parameter" parameterid="par_service_id"/><value type="value"><content><![CDATA["
                    },
                    {
                    "query": "$.validityPeriod.fromDate.dateString.dateStringformat.value=]]></content></value><value type="parameter" parameterid="par_timestamp_24h_before"/><value type="value"><content><![CDATA["
                    },
                    {
                    "query": "$.validityPeriod.toDate.dateString.dateStringformat.value=]]></content></value><value type="parameter" parameterid="par_timestamp_now"/><value type="value"><content><![CDATA["
                    }
                  ]
                }]]></content></value>
                <!-- <value type="value"><content><![CDATA[
                    {
                        "queries": [
                            {
                                "query": "$.id[?(@.schemeName='ServiceID')].value=VF00001_OK"
                            },
                            {
                                "query": "$.validityPeriod.fromDate.dateString.dateStringformat.value=202112030000"
                            },
                                    {
                                "query": "$.validityPeriod.toDate.dateString.dateStringformat.value=202113030000"
                            }
                        ]
                    }
                  ]]></content></value>-->
              </text>
            </body>
            <response type="json"/>
          </endpoint>
          </endpoints>
      </troubleshoot>
      
      <action>    
        <endpoints connecttimeout="300000" requesttimeout="20000">
        </endpoints>             	
    </action>

    </connectivity>

    <parameters>
        <parameter id="par_url_bizbus">
            <contents>
                <value type="lookup">url_list</value>
            </contents>
            <sequence>
                <operation type="row_delimiter">
                <args><arg><value type="value">;</value></arg></args>
                </operation>
                <operation type="column_delimiter">
                <args><arg><value type="value">,</value></arg></args>
                </operation>
                <operation type="column_index">
                <args><arg><value type="value">1</value></arg></args>
                </operation>
                <operation type="column_equal">
                <args><arg><value type="value">url_bizbus</value></arg></args>
                </operation>
                <operation type="column_selector">
                <args><arg><value type="value">2</value></arg></args>
                </operation>
            </sequence>
        </parameter>
        <parameter id="par_url_zhilabs">
            <contents>
                <value type="lookup">url_list</value>
            </contents>
            <sequence>
                <operation type="row_delimiter">
                <args><arg><value type="value">;</value></arg></args>
                </operation>
                <operation type="column_delimiter">
                <args><arg><value type="value">,</value></arg></args>
                </operation>
                <operation type="column_index">
                <args><arg><value type="value">2</value></arg></args>
                </operation>
                <operation type="column_equal">
                <args><arg><value type="value">url_zhilabs</value></arg></args>
                </operation>
                <operation type="column_selector">
                <args><arg><value type="value">3</value></arg></args>
                </operation>
            </sequence>
        </parameter>
        <parameter id="par_bizbus_clientid">
            <contents>
                <value type="lookup">url_list</value>
            </contents>
            <sequence>
                <operation type="row_delimiter">
                <args><arg><value type="value">;</value></arg></args>
                </operation>
                <operation type="column_delimiter">
                <args><arg><value type="value">,</value></arg></args>
                </operation>
                <operation type="column_index">
                <args><arg><value type="value">1</value></arg></args>
                </operation>
                <operation type="column_equal">
                <args><arg><value type="value">url_bizbus</value></arg></args>
                </operation>
                <operation type="column_selector">
                <args><arg><value type="value">3</value></arg></args>
                </operation>
            </sequence>
        </parameter>
        <!-- PCA20220401 - Si el cliente no tiene serviceid, la llamdada debe realizarse con siteid  - INICIO -->
        <parameter id="par_service_id" type="value" name="ID Servicio">
            <contents>
                <value type="parameter" role="front">par_grc_service_id</value><!--DBC20221027 -INC000057051335 - Se manda la informaciÃ³n del ID de Servicio y no el de contexto-->
            </contents> 
            <sequence>
              <operation type="replace_pattern">
                <args>
                  <arg>
                    <value type="value">unknown@to@</value><value type="parameter" role="front">par_customer_crmid</value>
                  </arg>
                </args>
              </operation>
            </sequence>
          </parameter>
        <!-- PCA20220401 - Si el cliente no tiene serviceid, la llamdada debe realizarse con siteid  - FIN -->

        <!-- ARL20211126 - NUEVO ENDPOINT - INICIO -->
        <parameter id="par_timestamp_24h_before_aux" type="value">
            <contents>
            <value type="localtimestamp"></value>
            </contents>
            <sequence>
            <operation type="subtract_value">
                <args><arg><value type="value">86400000</value></arg></args>
            </operation>
            <operation type="parse_timestamp">
                <args><arg><value type="value">yyyyMMddHH</value></arg></args>
            </operation>
            </sequence>
        </parameter>

        <parameter id="par_timestamp_24h_before" type="value">
            <contents>
            <value type="parameter">par_timestamp_24h_before_aux</value>
            <value type="value">00</value>
            </contents>
        </parameter>

        <parameter id="par_timestamp_now_aux" type="value">
            <contents>
            <value type="localtimestamp"></value>
            </contents>
            <sequence>
            <operation type="parse_timestamp">
                <args><arg><value type="value">yyyyMMddHH</value></arg></args>
            </operation>
            </sequence>
        </parameter>

        <parameter id="par_timestamp_now" type="value">
            <contents>
            <value type="parameter">par_timestamp_now_aux</value>
            <value type="value">00</value>
            </contents>
        </parameter>
    </parameters>

    <checks>
    </checks>

</template>



      
