<?xml version='1.0' encoding='UTF-8'?>
<template infosource="one_net" type="infosource" version="1.0">


    <!-- ############################################################################################## -->
    <!-- Version 1.0                                                                                    -->
    <!--  - Version de partida                                                                          -->
    <!-- ############################################################################################## -->


    <connectivity>

      <troubleshoot>

        <endpoints>

          <endpoint id="get_element_msisdn" verbose="true" lazy="true" type="ws" connecttimeout="30000" requesttimeout="40000">
            <method>POST</method>
            <url ignoreSSL="true">{url}/ServiceConfigurationREST/serviceConfiguration/search</url>
            <!--<url ignoreSSL="true">https://run.mocky.io/v3/f85e7400-b0f6-42be-9d3e-192c4c48e454</url>--> <!-- CAD20240104 - PRUEBAS NO SUBIR A OCU/PRO -->
            <args>
                <arg type="path" id="url">
                    <value type="parameter" parameterid="par_url_bizbus"/>
                </arg>
                <arg type="header" id="Accept">
                    <value type="value"><content>*/*</content></value>
                </arg>
                <arg type="header" id="X-IBM-Client-Id">
                    <value type="parameter" parameterid="par_bizbus_clientid"/>
                </arg>
                <arg type="header" id="X-VF-API-Process">
                    <value type="value"><content>getElementByMSISDN</content></value>
                </arg>
                <arg type="header" id="Content-Type">
                    <value type="value"><content>application/json</content></value>
                </arg>
            </args>
            <body contenttype="text">
              <text>
                <value type="value"><content>
                    <![CDATA[{
                      "queries": [
                      {
                      "query": "$.id[?(@.schemeID='msisdn')].value=]]></content></value><value type="parameter" parameterid="par_context_msisdn"/><value type="value"><content><![CDATA["
                      },
                      {
                      "query": "$.parts.service.id[?(@.schemeName='user')].value=Schaman"
                      }
                      ]
                      }
                  ]]></content></value>
              </text>
            </body>
            <response type="json"/>
          </endpoint>

          <endpoint id="get_element_vpn" verbose="true" lazy="true" type="ws" connecttimeout="30000" requesttimeout="40000">
            <method>POST</method>
            <url ignoreSSL="true">{url}/ServiceConfigurationREST/serviceConfiguration/search</url>
            <!--<url ignoreSSL="true">https://run.mocky.io/v3/49426023-922a-4672-b192-187930c3a5a3</url>--> <!-- CAD20240104 - PRUEBAS NO SUBIR A OCU/PRO -->
            <args>
                <arg type="path" id="url">
                    <value type="parameter" parameterid="par_url_bizbus"/>
                </arg>
                <arg type="header" id="Accept">
                    <value type="value"><content>*/*</content></value>
                </arg>
                <arg type="header" id="X-IBM-Client-Id">
                    <value type="parameter" parameterid="par_bizbus_clientid"/>
                </arg>
                <arg type="header" id="X-VF-API-Process">
                    <value type="value"><content>getElementVPN</content></value>
                </arg>
                <arg type="header" id="Content-Type">
                    <value type="value"><content>application/json</content></value>
                </arg>
            </args>
            <body contenttype="text">
              <text>
                <value type="value"><content>
                    <![CDATA[{
                      "queries": [
                      {
                      "query": "$.id[?(@.schemeName='vpnName')].value=]]></content></value><value type="parameter" role="front" parameterid="par_vpn_name"/><value type="value"><content><![CDATA["
                      },
                      {
                      "query": "$.parts.service.id[?(@.schemeName='user')].value=Schaman"
                      }
                      ]
                      }
                  ]]></content></value>
              </text>
            </body>
            <response type="json"/>
          </endpoint>
        </endpoints>

      </troubleshoot>

      <action>
        <endpoints>
    
          <endpoint id="update_by_msisdn" verbose="true" lazy="true" type="ws" connecttimeout="3000" requesttimeout="50000">
            <method>PATCH</method>
            <url ignoreSSL="true">{url}/ServiceConfigurationREST/serviceConfiguration/{id}</url>
            <args>
              <arg type="path" id="url">
                <value type="parameter" parameterid="par_url_bizbus"/>
              </arg>
              <arg type="path" id="id">
                <value type="parameter" parameterid="par_context_msisdn"/>
              </arg>
              <arg type="header" id="Accept">
                <value type="value"><content>*/*</content></value>
              </arg>
              <arg type="header" id="X-IBM-Client-Id">
                <value type="parameter" parameterid="par_bizbus_clientid"/>
              </arg>
              <arg type="header" id="X-VF-API-Process">
                <value type="value"><content>updateByMSISDN</content></value>
              </arg>
              <arg type="header" id="Content-Type">
                <value type="value"><content>application/json</content></value>
              </arg>
            </args>
            <body contenttype="text">
              <text>
                <value type="value"><content><![CDATA[[
                  {
                  "op": "replace",
                  "path": "$.status",
                  "value": {
                  "value": "AC"
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.id.[?(@.schemeName='user)].value",
                  "value": {
                  "value": "Schaman"
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].id[?(@.schemeName='vpnId')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gevpn_vpnid"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].id[?(@.schemeName='imsi')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="front" parameterid="par_imsi"/> <!-- CAD20230510 - Movil Partis --><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].id[?(@.schemeName='actionId')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_action_id_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].id[?(@.schemeName='groupId')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_group_id_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].id[?(@.schemeName='natExtTypeId')].value",
                  "value": {
                  "value": "]]></content></value><value type="argument" argumentid="arg_gemsisdn_nat_ext_type_id_action_parameter"/><!-- CAD20231127 - Diagnosticos VoLTE - VBTS_Schaman_001 y VBTS_Schaman_002 --><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].id[?(@.schemeName='secGroupId')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_nat_sec_group_id_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='addNumber_cli_f')].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_addnumber_cli_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='block_f')].value",
                  "value": {
                  "value": false
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='cliDisplayType')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_cli_display_type_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='ims_f')].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_ims_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='languageCode')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_language_code_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='paccount_f)].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_paccount_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='pms_f')].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_pms_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='selectiveCLIR_f)].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_selective_clir_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='sms_f)].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_sms_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.resource[*].category[?(@.listName='srvICS_f')].value",
                  "value": {
                  "value": ]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_srv_ics_f_action_parameter"/><value type="value"><content><![CDATA[
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.serviceSpecification.characteristicsValue[?(@.characteristicName='addNumber')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_addnumber_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.serviceSpecification.characteristicsValue[?(@.characteristicName='displayName')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_display_name_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.serviceSpecification.characteristicsValue[?(@.characteristicName='nomadicNumber')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_nomadic_number_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.serviceSpecification.characteristicsValue[?(@.characteristicName='secShortNumber')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="one_net" parameterid="par_gemsisdn_sec_short_number_action_parameter"/><value type="value"><content><![CDATA["
                  }
                  },
                  {
                  "op": "replace",
                  "path": "$.parts.service.serviceSpecification.characteristicsValue[?(@.characteristicName='shortNumber')].value",
                  "value": {
                  "value": "]]></content></value><value type="parameter" role="front" parameterid="par_vpn_shortnumber"/><value type="value"><content><![CDATA["
                  }
                  }
                  ]
                ]]></content></value>
              </text>
            </body>
            <response type="json"/>
          </endpoint>
        </endpoints>
      </action>
      
    </connectivity>

    <parameters>

      <!-- ENDPOINT REQUEST PARAMETERS -->

      <parameter id="par_url_bizbus">
        <contents>
          <value type="lookup">url_list</value>
        </contents>
        <sequence>
          <operation type="row_delimiter">
            <args><arg><value type="value">;</value></arg></args>
          </operation>
          <operation type="column_delimiter">
            <args><arg><value type="value">,</value></arg></args>
          </operation>
          <operation type="column_index">
            <args><arg><value type="value">1</value></arg></args>
          </operation>
          <operation type="column_equal">
            <args><arg><value type="value">url_bizbus</value></arg></args>
          </operation>
          <operation type="column_selector">
            <args><arg><value type="value">2</value></arg></args>
          </operation>
        </sequence>
      </parameter>
      
      <parameter id="par_bizbus_clientid">
          <contents>
            <value type="lookup">url_list</value>
          </contents>
          <sequence>
            <operation type="row_delimiter">
              <args><arg><value type="value">;</value></arg></args>
            </operation>
            <operation type="column_delimiter">
              <args><arg><value type="value">,</value></arg></args>
            </operation>
            <operation type="column_index">
              <args><arg><value type="value">1</value></arg></args>
            </operation>
            <operation type="column_equal">
              <args><arg><value type="value">url_bizbus</value></arg></args>
            </operation>
            <operation type="column_selector">
              <args><arg><value type="value">3</value></arg></args>
            </operation>
          </sequence>
      </parameter>

      <!-- ENDPOINT REQUEST PARAMS -->
      <parameter id="par_url_bus" techview="never">
        <contents>
            <value type="lookup">url_list</value>
        </contents>
        <sequence>
          <operation type="row_delimiter">
            <args><arg><value type="value">;</value></arg></args>
          </operation>
          <operation type="column_delimiter">
            <args><arg><value type="value">,</value></arg></args>
          </operation>
          <operation type="column_index">
            <args><arg><value type="value">1</value></arg></args>
          </operation>
          <operation type="column_equal">
            <args><arg><value type="value">url_bus</value></arg></args>
          </operation>
          <operation type="column_selector">
            <args><arg><value type="value">2</value></arg></args>
          </operation>
        </sequence>
      </parameter>

      <parameter id="par_url_schaman" type="value" techview="never"><!-- -->
        <contents>
            <value type="lookup">url_list</value>
        </contents>
        <sequence>
          <operation type="row_delimiter">
              <args><arg><value type="value">;</value></arg></args>
          </operation>
          <operation type="column_delimiter">
              <args><arg><value type="value">,</value></arg></args>
          </operation>
          <operation type="column_index">
              <args><arg><value type="value">1</value></arg></args>
          </operation>
          <operation type="column_equal">
              <args><arg><value type="value">url_schaman_mailbox</value></arg></args>
          </operation>
          <operation type="column_selector">
              <args><arg><value type="value">2</value></arg></args>
          </operation>
        </sequence>
      </parameter>

      <parameter id="par_schaman_authorization" type="value" techview="never"><!-- -->
        <contents>
            <value type="lookup">url_list</value>
        </contents>
        <sequence>
          <operation type="row_delimiter">
              <args><arg><value type="value">;</value></arg></args>
          </operation>
          <operation type="column_delimiter">
              <args><arg><value type="value">,</value></arg></args>
          </operation>
          <operation type="column_index">
              <args><arg><value type="value">1</value></arg></args>
          </operation>
          <operation type="column_equal">
              <args><arg><value type="value">url_schaman_mailbox</value></arg></args>
          </operation>
          <operation type="column_selector">
              <args><arg><value type="value">3</value></arg></args>
          </operation>
        </sequence>
      </parameter>

      <parameter id="par_bus_clientid" techview="never">
        <contents>
            <value type="lookup">url_list</value>
        </contents>
        <sequence>
          <operation type="row_delimiter">
            <args><arg><value type="value">;</value></arg></args>
          </operation>
          <operation type="column_delimiter">
            <args><arg><value type="value">,</value></arg></args>
          </operation>
          <operation type="column_index">
            <args><arg><value type="value">1</value></arg></args>
          </operation>
          <operation type="column_equal">
            <args><arg><value type="value">url_bus</value></arg></args>
          </operation>
          <operation type="column_selector">
            <args><arg><value type="value">3</value></arg></args>
          </operation>
        </sequence>
      </parameter>

      <parameter id="par_cm_ip" type="value" name="IP CM">
        <contents>
          <value type="parameter" role="inet">par_gsip_oip_cm_ip_address</value>
        </contents>
      </parameter>

      <!--DBC_Revisar si se usa-->
      <parameter id="par_td_version" type="value" techview="never">
        <contents>
          <value type="value">1</value>
        </contents>
      </parameter>

      <!-- Valor del MSISDN del cliente -->
      <parameter id="par_context_msisdn" type="value" name="MSISDN">
        <contents>
          <value type="context">ipt_service_id</value> <!-- Pendiente definir el valor correcto a recuperar -->
        </contents>
      </parameter>

    </parameters>

    <checks>
    </checks>

</template>
