<?xml version='1.0' encoding='UTF-8'?>
<template version="1.0" infosource="historicalms" type="infosource">
	<connectivity>
		<troubleshoot>
			<endpoints>
                <endpoint id="getdiagnosisexecution" type="ws" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="5000">
                    <method>GET</method>
                    <url>{url}/schaman-historical/api/1/service/{serviceId}/activity</url>
                    <response type="json"/>
                    <args>
                        <arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_schaman_historical"/>
                        </arg>
                        <arg type="path" id="serviceId">
                            <value type="parameter" parameterid="par_service_id" role="front"/>
                        </arg>
                        <arg type="query" id="filter">
                            <value type="value"><content>type:in:diagnosis</content></value>
                            <value type="value"><content>,ttCreated:gt:</content></value>
                            <value type="parameter" parameterid="par_filtertimeformat_currenttimelessthreshold"/>
                        </arg>
                        <arg type="query" id="order">
                            <value type="value"><content>desc:ttCreated</content></value>
                        </arg>
                        <arg type="query" id="limit">
                            <value type="value"><content>20</content></value>
                        </arg>
                    </args>
                </endpoint>
                
                <endpoint id="getsessions" type="ws" verbose="true" lazy="true" connecttimeout="4000" requesttimeout="5000">
                    <method>GET</method>
                    <url>{url}/schaman-historical/api/1/service/{serviceId}/session</url>
                    <response type="json"/>
                    <args>
                        <arg type="path" id="url">
                            <value type="parameter" parameterid="par_url_schaman_historical"/>
                        </arg>
                        <arg type="path" id="serviceId">
                            <value type="parameter" parameterid="par_service_id" role="front"/>
                        </arg>
                        <arg type="query" id="order">
                            <value type="value"><content>desc:ttCreated</content></value>
                        </arg>
                        <arg type="query" id="limit">
                            <value type="value"><content>20</content></value>
                        </arg>
                    </args>
                </endpoint>
			</endpoints>
		</troubleshoot>
        <action>
            <endpoints/>
        </action>
	</connectivity>
	<parameters>
        <parameter id="par_url_schaman_historical" type="value" techview="never">
            <contents>
                <value type="lookup">url_list</value>
            </contents>
            <sequence>
                <operation type="row_delimiter">
                    <args><arg><value type="value">;</value></arg></args>
                </operation>
                <operation type="column_delimiter">
                    <args><arg><value type="value">,</value></arg></args>
                </operation>
                <operation type="column_index">
                    <args><arg><value type="value">1</value></arg></args>
                </operation>
                <operation type="column_equal">
                    <args><arg><value type="value">url_schaman_historical</value></arg></args>
                </operation>
                <operation type="column_selector">
                    <args><arg><value type="value">2</value></arg></args>
                </operation>
            </sequence>
        </parameter>

        <parameter id="par_filtertimeformat_currenttimelessthreshold" type="value">
            <contents>
                <value type="localtimestamp"/>
            </contents>
            <sequence>
                <operation type="subtract_value">
                    <args><arg><value type="parameter">par_diagnoses_reiteration_threshold_mins</value></arg></args>
                </operation>
                <operation type="parse_timestamp">
                    <args><arg><value type="value">yyyy-MM-dd'T'HH:mm:ss.SSSZ</value></arg></args>
                </operation>
            </sequence>
        </parameter>

        <!--CCA20230811 - SP2901 - inicio-->
        <parameter id="par_customer_type_segmento_front" type="value">
            <contents>
                <value type="parameter" role="front">par_customer_type_segmento</value>
            </contents>
        </parameter>
        <!--CCA20230811 - SP2901 - fin-->

        <parameter id="par_diagnoses_reiteration_threshold_mins" type="value">
            <contents>
              <value type="lookup">SCHPROD_historical_reiteration_threshold</value>
            </contents>
            <sequence>
              <operation type="row_delimiter">
                <args><arg><value type="value">;</value></arg></args>
              </operation>
              <operation type="column_delimiter">
                <args><arg><value type="value">,</value></arg></args>
              </operation>
              <operation type="column_index">
                <args><arg><value type="value">1</value></arg></args>
              </operation>
              <operation type="column_equal">
                <args><arg><value type="context">source</value></arg></args>
              </operation>
              <operation type="column_index">
                <args><arg><value type="value">2</value></arg></args>
              </operation>
              <operation type="column_equal">
                <args><arg><value type="context">sourcedetail</value></arg></args>
              </operation>
              <!--CCA20230811 - SP2901 - inicio-->
              <operation type="column_index">
                <args><arg><value type="value">3</value></arg></args>
              </operation>
              <operation type="column_equal">
                <args><arg><value type="parameter">par_customer_type_segmento_front</value></arg></args>
              </operation>
              <operation type="column_index">
                <args><arg><value type="value">4</value></arg></args>
              </operation>
              <operation type="multiply_value">
                <args><arg><value type="value">60000</value></arg></args>
              </operation>
              <operation type="column_selector">
                <args><arg><value type="value">4</value></arg></args>
              </operation>
              <!--CCA20230811 - SP2901 - fin-->
			  
            </sequence>
        </parameter>
    </parameters>
	<checks/>
</template>